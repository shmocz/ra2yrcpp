# FIXME: find better way to include protocol stuff
include_directories(${CMAKE_BINARY_DIR}/src)

include_directories(../src)
function(make_test test_name)
    add_executable(${test_name} ${ARGV})
    target_Link_libraries(${test_name} gtest_main)
    add_test(NAME ${test_name} COMMAND test_name)
endfunction()
make_test(test_hooks test_hooks.cpp ../src/hook.cpp ../src/process.cpp ../src/errors.cpp)
make_test(test_process test_process.cpp ../src/process.cpp ../src/errors.cpp ../src/utility/scope_guard.hpp)
make_test(test_server test_server.cpp)
target_link_libraries(test_server instrumentation_service)
make_test(test_instrumentation_service test_instrumentation_service.cpp)
target_link_libraries(test_instrumentation_service instrumentation_service)
